<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Merienda&display=swap" rel="stylesheet">
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">	
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ -->
    <div class="top-links">
        <a href="/" class="top-link">–ì–ª–∞–≤–Ω–∞—è</a> |
        <a href="/images" class="top-link">–ö–∞—Ç–∞–ª–æ–≥ –∫–∞—Ä—Ç–∏–Ω–æ–∫</a>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫ -->
    <div class="container">
        <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞) -->
		<div class="messages">
			{% with messages = get_flashed_messages(with_categories=true) %}		
				{% for category, message in messages %}
					<div class="alert {{ category }}">
						<div><strong>{{ message[0] }}</strong></div>
						{% if message[1] %}
						<div>
							<button id="copyBtn">üìã</button>
							{{ message[1] | safe }}
						</div>							
						{% endif %}									
					</div>
				{% endfor %}
			{% endwith %}			
		</div>
		
        <h1>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ üê±</h1>
        <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Äî 5 MB.</p>

        <form action="/upload" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="chooseFile" class="btn">
                    <span>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª üñºÔ∏è</span>
                    <input type="file" name="file" id="chooseFile" class="file-input" required>
                </label>
                <input type="submit" id="loadBtn" value="–ó–∞–≥—Ä—É–∑–∏—Ç—å üòª" class="btn btn-inactive">
            </div>
        </form>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
			const chooseFileBtn = document.getElementById('chooseFile'); // –∫–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏
			const loadBtn = document.getElementById('loadBtn'); // –∫–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏
			const copyBtn = document.getElementById('copyBtn'); // –∫–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
			const MAX_FILE_SIZE = 5 * 1024 * 1024; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ 5MB
			const form = document.querySelector('form');  // —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞
			const messagesContainer = document.querySelector('.messages'); // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
			
			// –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞
			function chooseFileBtnChange() {				
				loadBtn.classList.remove('btn-inactive'); // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–∫—Ç–∏–≤–Ω–∞
			}
			
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
			function copyBtnClick() {
				// –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É
				const link = document.querySelector(".alert a");
				
				// –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
				const tempInput = document.createElement("input");
				tempInput.value = link.href;
				document.body.appendChild(tempInput);
				tempInput.select();
				document.execCommand("copy"); // –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
				document.body.removeChild(tempInput);
			}
			
			// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏
			function loadBtnClick(event) {
				const file = chooseFileBtn.files[0];
				
				// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
				if (file && file.size > MAX_FILE_SIZE) {
					event.preventDefault(); // –û—Ç–º–µ–Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
					loadBtn.classList.add('btn-inactive'); // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
					chooseFileBtn.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
										
					messagesContainer.innerHTML = ''; // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
					
					// –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
					const errorMessageDiv = document.createElement('div');
					errorMessageDiv.classList.add('alert', 'error');
					const errorMessage = document.createElement('div');
					errorMessage.innerHTML = `<strong>–û—à–∏–±–∫–∞: —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 5MB.</strong>`;
					errorMessageDiv.appendChild(errorMessage);
					messagesContainer.appendChild(errorMessageDiv);
					
					// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
					fetch('/upload-error', {
						method: 'POST',
						headers: {'Content-Type': 'application/json'},
						body: JSON.stringify({ error: `–û—à–∏–±–∫–∞: —Ñ–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π - ${file.size / 1024 / 1024} MB` })
					})
					.then(response => response.json())  // –ñ–¥–µ–º JSON-–æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
					.then(data => {
						console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:", data);
					})
					.catch(error => {
						console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:", error);
					});
				}
			}			
			
			chooseFileBtn.addEventListener('change', chooseFileBtnChange); // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
			copyBtn.addEventListener('click', copyBtnClick); // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
			form.addEventListener('submit', loadBtnClick); // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
        });
    </script>
</body>
</html>