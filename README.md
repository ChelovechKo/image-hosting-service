##########################
#  Image Hosting Service #
##########################
Это учебный проект, который представляет из себя сервис для хранения картинок. Это место, где пользователи могут:
- Загружать картинки в форматах - .jpg, .png, .gif
- Быть уверенными, что картинки надежно сохранены.
- Получать удобные прямые ссылки на загруженные изображения.

##########################
#       Как начать       #
##########################

1. Склонируйте репозиторий в рабочую директорию:
git clone https://github.com/ChelovechKo/image-hosting-service.git
2. Из рабочей директории запустите проект командой
docker compose up --build
3. Перейдите по адресу http://localhost:8080/ на главную страницу

##########################
#         Общее          #
##########################

Приведенный код представляет собой хостинг картинок.
Бэкенд написан на Python, для раздачи картинок используется Nginx, все части упакованы в Docker-контейнеры, для управления используется Docker Compose.

**В основной директории лежат файлы:**
 - README.md - текстовое описание проекта и из чего он состоит
 - app.py - внутренняя логика сервиса, написанная на Python
 - requirements.txt - необходимые зависимости Python
 - Dockerfile - Dockerfile для Python-бэкенда
 - docker-compose.yml - Конфигурация Docker Compose
 - nginx.conf - Конфигурация Nginx
 - images/ - Папка для хранения загруженных изображений (volume)
 - logs/  - Папка для логов (volume)
 - static/ - Папка для хранения статических файлов CSS
 - templates/ - Папка для хранения HTML шаблонов страниц сервиса
 - backups/ - Папка для хранения резервных копий базы данных

**В папку templates/ вынесены отдельно шаблоны страниц:**
 - index.html - Главная страница, находящаяся по маршруту `/`. Содержит краткую информацию о сервисе и содержит ссылки на страницу загрузки картинок и на страницу каталога картинок.
 - upload.html - Страница загрузки картинок, находящаяся по маршруту `/upload`. Предоставляет пользователю возможность загрузить картинку. При неудачной попатке показывает сообщение об ошибке, при удачной - отдаёт пользователю ссылку на загруженную картинку.
 - images.html - Страница с каталогом загруженных картинок, находящаяся по маршруту /images/. Содержит все загруженные ранее картинки, предоставляет пользователю возможность просмотреть и скачать выбранную картинку.

##########################
#      Спецификация      #
##########################
 
Image Hosting Service

**1. Главная страница**

- **Маршрут:** `/`
- Функциональность:
  - Встречает пользователя приветственным сообщением и рассказывает о сервисе.
  - Содержит ссылки на основные маршруты:
  - Страница загрузки изображений (`/upload`).
  - Каталог загруженных изображений (`/images/`).

**2. Загрузка изображений**

- **Маршрут:** `/upload`
- **Метод:** `POST`
- Функциональность:
   - Принимает файл изображения от пользователя через HTTP-запрос.
   - Поддерживаемые форматы: `.jpg`, `.png`, `.gif`.
   - Ограничение размера файла: до 5 МБ.
   - Генерирует уникальное имя для каждого загружаемого изображения.
   - Сохраняет изображение в папку `/images` на сервере.
   - Возвращает пользователю уникальный идентификатор файла и ссылку на изображение.
   - Сохраняет метаданные по изображению в базу данных

**3. Доступ к загруженным изображениям**

- **Маршрут:** `/images/<имя_файла>`
- Функциональность:
   - Все загруженные изображения должны быть доступны для просмотра и скачивания по прямым ссылкам.
   - Nginx обслуживает этот маршрут, раздавая файлы из папки `/images`.

**4. Просмотр списка изображений**
- **Маршрут:** `/images
- Функциональность:
	- на веб-странице в виде таблицы отображаются загруженные изображения
	- для изображения указаны Имя файла, Оригинальное имя, Размер (Кб), Дата загрузки, Тип файла, Действие (Удалить)
	- при нажатие на Имя файла происходит просмотр изображения
	- при нажатие на Действие (Удалить) происходит удаление изображения
	- на странице добавлена пагинация. Изображения отображаются группами по 10. Переход к другим страницам осуществляется через кнопки "Следующая страница" и "Предыдущая страница"
	
**5. Удаление изображения**	
- **Маршрут:** /delete/<int:image_id>
- Функциональность:
	- удаление изображения можно выполнить со страницы каталога изображений
	- запись об изображении удаляется из базы данных
	- физический файл удаляется из папки `/images`.

**6. Логирование действий**

- Функциональность:
  - Записывает каждое действие пользователя в лог-файл `app.log`.
- Формат записи:
   ```txt
   [Дата/время] Действие: сообщение
   ```
- Логи нужно хранить в отдельном томе Docker.

**8. База данных**
Метаданные об изображениях хранятся в базе данных. При первом запуске контейнера инициализируется таблица images для хранения изображений.


**9. Резервное копирование**
Откройте Git Bash (или WSL), перейдите в каталог проекта, где лежит backup.sh, и выполните:

./backup.sh


**10. Восстановление из резервной копии**
Выполните в терминале:

docker exec -i project2_db_1 psql -U postgres images_db < backups/<backup_file>.sql

где <backup_file> - нужное имя файла из папки backups/